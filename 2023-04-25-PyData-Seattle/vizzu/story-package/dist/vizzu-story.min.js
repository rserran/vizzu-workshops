const t=["%cVIZZU%cCONTROLLER","background: #e2ae30; color: #3a60bf; font-weight: bold","background: #3a60bf; color: #e2ae30;"];class e extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=this._render(),this._update=this.update.bind(this),this._keyHandler=this._handleKey.bind(this),this.shadowRoot.addEventListener("click",(t=>{const e=t.target.closest("button");e&&("start"===e.id?this.toStart():"end"===e.id?this.toEnd():"previous"===e.id?this.previous():"next"===e.id?this.next():"fullscreen"===e.id&&this.fullscreen())}))}update(t){const e=t.detail;this.log("update",e),this._state=e,e.locked?this.setAttribute("locked",""):this.removeAttribute("locked"),0===e.currentSlide?this.setAttribute("first",""):this.removeAttribute("first"),e.currentSlide===e.length-1?this.setAttribute("last",""):this.removeAttribute("last"),this.shadowRoot.getElementById("status").innerHTML=this._html_status}get _html_status(){return`<span class="current">${(this._state?.currentSlide||0)+1}</span>/<span class="length">${this._state?.length||"?"}</span>`}_unsubscribe(t){t?.removeEventListener("update",this._update),this._player=null}_subscribe(t){t?.addEventListener("update",this._update),this._player=t}_handleKey(t){const e=this._player?.getAttribute("keyboard")||"focus";this.log(`key[${e}]: ${t.key}`),("focus"===e||"fullscreen"===e&&document.fullscreenElement)&&("PageDown"===t.key||"ArrowRight"===t.key?this.next():"PageUp"===t.key||"ArrowLeft"===t.key?this.previous():"Home"===t.key?this.toStart():"End"===t.key?this.toEnd():"f"===t.key||"F"===t.key?this.fullscreen():"Escape"===t.key&&document.fullscreenElement&&document.exitFullscreen())}connectedCallback(){if(!this._player){const t=this.getRootNode()?.host;"VIZZU-PLAYER"===t.nodeName&&(this._player=this.getRootNode()?.host,this._subscribe(this._player))}this._player&&this._player.addEventListener("keydown",this._keyHandler)}disconnectedCallback(){this._player&&(this._player.removeEventListener("keydown",this._keyHandler),this._unsubscribe(this._player))}get player(){return this._player}set player(t){this._player=t}get debug(){try{return document.cookie.split(";").some((t=>t.startsWith("vizzu-debug")))||this.hasAttribute("debug")}catch(t){return this.hasAttribute("debug")}}set debug(t){document.cookie=`vizzu-debug=${t?"true":""}; path=/`}log(...e){this.debug&&console.log(...t,...e)}seek(t){this.log("seek",t),this.player?.seek(t)}toStart(){this.log("toStart"),this.player?.toStart()}toEnd(){this.log("toEnd"),this.player?.toEnd()}previous(){this.log("previous"),this.player?.previous()}next(){this.log("next"),this.player?.next()}get fullscreenTarget(){return this._fullscreenTarget||this.getRootNode()?.host||this.parentElement}fullscreen(){this.log("fullscreen"),document.fullscreenElement?document.exitFullscreen():this.fullscreenTarget?.requestFullscreen()}_render(){return`\n      <style>\n        :host {\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          width: 100%;\n          max-width: 100%;\n          overflow-x: hidden;\n          padding: 20px 0 10px;\n          min-height: 22px;\n          font-family: sans-serif;\n          --_c: var(--vizzu-button-color, #c6c6c6);\n          --_bg: var(--vizzu-button-background-color, #fff);\n          --_hc: var(--vizzu-button-hover-color, #494949);\n          color: var(--_c);\n        }\n        :host([first]) #start,\n        :host([first]) #previous,\n        :host([last]) #end,\n        :host([last]) #next,\n        :host([locked]) {\n          pointer-events: none;\n          opacity: 0.5;\n        }\n        button {\n          background: transparent;\n          padding: 0;\n          margin: 0;\n          border: none;\n          cursor: pointer;\n          min-width: 25px;\n          height: 22px;\n        }\n        button > svg {\n          vertical-align: middle;\n        }\n        button > svg path {\n          fill: var(--_c);\n        }\n        button:hover > svg path {\n          fill: var(--_hc);\n        }\n        #playerctrls {\n          display: flex;\n          flex: 1;\n          justify-content: space-between;\n          align-items: center;\n          max-width: 550px;\n          margin: 0 10px;\n        }\n        #status {\n          margin-left: 10px;\n        }\n        #fullscreen {\n          margin-right: 10px;\n        }\n        #splaceholder {\n          flex: 1;\n          max-width: 350px;\n          min-width: 60px;\n        }\n        [aria-label] {\n          position: relative;\n        }\n        [aria-label]:hover::after {\n          content: attr(aria-label);\n          color: var(--_hc);\n          position: absolute;\n          top: -14px;\n          left: -20em;\n          right: -20em;\n          text-align: center;\n        }\n      </style>\n      <div id="status">${this._html_status}</div>\n      <div id="playerctrls">\n        <button id="start" aria-label="First">\n          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="11" height="11" viewBox="0 0 11 11">\n            <path id="first-pass" d="M1.467,5.867 L1.467,5.133 L11.000,0.000 L11.000,2.200 L11.000,8.800 L11.000,11.000 L1.467,5.867 zM0.000,11.000 C0.000,11.000 0.000,2.019 0.000,-0.000 C0.000,-0.000 1.467,-0.000 1.467,-0.000 L1.467,11.000 L0.000,11.000 z" fill="#A2A2A2" />\n          </svg>\n        </button>\n        <button id="previous" aria-label="Prev.">\n          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="13" height="15" viewBox="0 0 13 15">\n            <path id="play_pass" d="M13.000,15.000 L-0.000,8.000 L-0.000,7.000 L13.000,-0.000 L13.000,15.000 z" fill="#A2A2A2" />\n          </svg>\n        </button>\n        <div id="splaceholder"></div>\n        <button id="next" aria-label="Next">\n          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="13" height="15" viewBox="0 0 13 15">\n            <path id="nextBtn" d="M-0.000,15.000 L13.000,8.000 L13.000,7.000 L-0.000,-0.000 L-0.000,15.000 z" fill="#A2A2A2" />\n          </svg>\n        </button>\n        <button id="end" aria-label="Last">\n          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="11" height="11" viewBox="0 0 11 11">\n            <path id="first-pass" d="M9.533,5.133 L-0.000,-0.000 L-0.000,2.200 L-0.000,8.800 L-0.000,11.000 L9.533,5.867 L9.533,5.133 zM11.000,-0.000 C11.000,-0.000 9.533,-0.000 9.533,-0.000 C9.533,11.000 9.533,11.000 9.533,11.000 L11.000,11.000 C11.000,11.000 11.000,2.019 11.000,-0.000 z" fill="#A2A2A2" />\n          </svg>\n        </button>\n      </div>\n      <button id="fullscreen" aria-label="Toggle fullscreen">\n        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="15" height="15" viewBox="0 0 15 15">\n          <path id="fullscreen_pass" d="M9.000,12.000 L12.000,12.000 L12.000,9.000 L15.000,9.000 L15.000,15.000 L12.000,15.000 L9.000,15.000 L9.000,12.000 zM9.000,-0.000 L15.000,-0.000 L15.000,6.000 L12.000,6.000 L12.000,3.000 L9.000,3.000 L9.000,-0.000 zM3.000,9.000 L3.000,12.000 L6.000,12.000 L6.000,15.000 L-0.000,15.000 L-0.000,9.000 L3.000,9.000 zM-0.000,-0.000 L6.000,-0.000 L6.000,3.000 L3.000,3.000 L3.000,6.000 L-0.000,6.000 L-0.000,-0.000 z" fill="#A2A2A2" />\n        </svg>\n      </button>\n      `}}try{customElements.get("vizzu-controller")?console.warn("VizzuController already defined"):customElements.define("vizzu-controller",e)}catch(t){console.error("Failed to register custom element: ",t)}const i=["%cVIZZU%cPLAYER","background: #e2ae30; color: #3a60bf; font-weight: bold","background: #3a60bf; color: #e2ae30;"];class s extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=this._render(),this._resolveVizzu=null,this.initializing=new Promise((t=>{this._resolveVizzu=t})).then((()=>this.vizzu.initializing))}async connectedCallback(){await this._initVizzu(),this.hasAttribute("tabindex")||(this.setAttribute("tabindex",0),this.tabIndex=0)}get debug(){try{return document.cookie.split(";").some((t=>t.startsWith("vizzu-debug")))||this.hasAttribute("debug")}catch(t){return this.hasAttribute("debug")}}log(...t){this.debug&&console.log(...i,...t)}get vizzuUrl(){return this.getAttribute("vizzu-url")||"https://cdn.jsdelivr.net/npm/vizzu@0.7/dist/vizzu.min.js"}async _initVizzu(){if(!this.vizzu){const t=window.Vizzu||(await import(this.vizzuUrl)).default;this._resolveVizzu(t),this.vizzu=new t(this.vizzuCanvas)}}_slideToAnimparams(t){const e=[];if(t._id)e.push(t._id);else{const i={};t.config&&(i.config=t.config),t.style&&(i.style=t.style),t.data&&(i.data=t.data),void 0!==t.filter&&(i.data||(i.data={}),i.data.filter=t.filter),e.push(i)}return t.animOptions&&e.push(t.animOptions),e}async _convertSlides(t){if(t?.slides?.length){Array.isArray(t.slides[0])||(t.slides[0]=[t.slides[0]]);const e=t.slides[0][0];e.data=e.data||Object.assign({},t.data),e.style=e.style||t.style}await this.initializing;const e=()=>this._seekToEnd();this.vizzu.on("animation-begin",e),this._nullSlide=this.vizzu.store();const i=[];for(const e of t.slides){let t=e;Array.isArray(t)||(t=[t]);const s=[];for(const e of t){const t=this._slideToAnimparams(e);await this.vizzu.animate(...t),t[0]=this.vizzu.store(),s.push(t)}i.push(s)}return i.length&&await this.vizzu.animate(...i[0][0]),this.vizzu.off("animation-begin",e),i}get slides(){return this._slides}set slides(t){this._currentSlide=0,this._setSlides(t)}get _locked(){return this._lock}set _locked(t){t?this._lock?this.log("!ALREADY LOCKED!"):(this.setAttribute("locked",""),this._lock=t):(this.removeAttribute("locked"),clearTimeout(this._lock),this._lock=!1)}acquireLock(t=1e3){return this._locked?(this.log("lock already acquired"),!1):(this.log("acquire lock"),this._locked=setTimeout((()=>{this._locked=!1}),t),this._locked)}releaseLock(){this.log("release lock"),this._locked=!1}async _setSlides(t){this.acquireLock()&&(this.setAttribute("initializing",""),this._originalSlides=t,this._slides=await this._convertSlides(t),this.releaseLock(),this.setSlide(this._currentSlide),this.removeAttribute("initializing"))}get vizzuCanvas(){return this.shadowRoot.getElementById("vizzu")}get length(){return this._slides?.length||0}get currentSlide(){return this._currentSlide}set currentSlide(t){this.setSlide(t)}get slide(){return this._slides?.[this._currentSlide]}get _includeController(){return this.hasAttribute("controller")}async _step(t){return await this.vizzu.animate(...t)}async _jump(t,e,i){return new Promise((s=>setTimeout((async()=>{this.log("jump to",t,e,i);const n=this._slides[t][e],r=()=>this._seekTo(i);if(this.vizzu.feature("rendering",!1),e>0){const i=this._slides[t][e-1],s=()=>this._seekToEnd();this.vizzu.on("animation-begin",s),await this.vizzu.animate(...i),this.vizzu.off("animation-begin",s)}else if(t>0){const e=this._slides[t-1],i=e[e.length-1],s=()=>this._seekToEnd();this.vizzu.on("animation-begin",s),await this.vizzu.animate(...i),this.vizzu.off("animation-begin",s)}this.vizzu.feature("rendering",!0),this.vizzu.on("animation-begin",r),await this.vizzu.animate(...n),this.vizzu.off("animation-begin",r),s(this.vizzu)}),0)))}async _seekTo(t){return new Promise((e=>setTimeout((()=>{this.vizzu.animation.seek(`${t}%`),e(this.vizzu)}),0)))}async _seekToStart(){return this._seekTo(0)}async _seekToEnd(){return this._seekTo(100)}async setSlide(t,e){if(0!==this.length&&this.acquireLock()){if(this._update(this._state),!t||t<0?t=0:t>=this.length&&(t=this.length-1),void 0!==e)this._subSlide=e,await this._step(this._slides[t][e]);else if(this._currentSlide-t==1){const e=this._slides[this._currentSlide];for(let t=e.length-1;t>=0;t--)this._subSlide=t,await this._step(e[t]);const i=this._slides[t];await this._step(i[i.length-1])}else if(this._currentSlide-t==-1){const e=this._slides[t];for(let t=0;t<e.length;t++)this._subSlide=t,await this._step(e[t])}else{const e=this._slides[t];this._subSlide=e.length-1,await this._step(e[e.length-1])}this._currentSlide=t,this._seekPosition=100,this._subSeekPosition=100,this.releaseLock(),this._update(this._state)}}next(){return this.setSlide(this.currentSlide+1)}previous(){return this.setSlide(this.currentSlide-1)}toStart(){return this.setSlide(0)}toEnd(){return this.setSlide(this.length-1)}async seek(t){if(this.acquireLock()){this._update(this._state),this.log(`seek to ${t}%, current: ${this._seekPosition}% [${this._currentSlide}/${this._subSlide}]`);const e=100/this.slide.length;let i=Math.floor(t/e),s=100*(t-i*e)/e;this.log(`ss ${i}, sp ${s}`),i>=this.slide.length&&(i=this.slide.length-1,s=100),i!==this._subSlide?(this._subSlide=i,await this._jump(this._currentSlide,this._subSlide,s)):this.vizzu.animation.seek(`${s}%`),this._seekPosition=t,this._subSeekPosition=s,this.releaseLock()}this._update(this._state)}get _state(){return{currentSlide:this.currentSlide,slide:this.slide,subSlide:this._subSlide,seekPosition:this._seekPosition,subSeekPosition:this._subSeekPosition,length:this.length,locked:this._locked}}_update(t){const e=new CustomEvent("update",{detail:t});this.dispatchEvent(e)}get customSpinner(){return this.getAttribute("custom-spinner")}_render(){return`\n      <style>\n        :host {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: center;\n          width: 100%;\n          height: 100%;\n          --_c: var(--vizzu-color, #333);\n          --_bg: var(--vizzu-background-color, #fff);\n          background-color: var(--_bg);\n        }\n        :host(:focus) {\n          outline: none;\n        }\n        :host([initializing]) #vizzu {\n          visibility: hidden;\n        }\n        :host([initializing]) .spinner {\n          display: block;\n        }\n        #vizzucnt {\n          position: relative;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          width: 100%;\n          max-height: calc(100% - 52px);\n          box-sizing: border-box;\n          flex: 1;\n        }\n        #vizzu {\n          width: 100%;\n          height: 100%;\n          flex: 1;\n        }\n        .spinner {\n          display: none;\n          position: absolute;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          margin: auto;\n          width: 80px;\n          height: 80px;\n        }\n        ${this.customSpinner?`\n        .spinner {\n          background-image: url(${this.customSpinner});\n          background-repeat: no-repeat;\n          background-position: center;\n          width: auto;\n          height: auto;\n        }`:'\n        .spinner:after {\n          content: " ";\n          display: block;\n          width: 64px;\n          height: 64px;\n          margin: 8px;\n          border-radius: 50%;\n          border: 6px solid #fff;\n          border-color: var(--_c) transparent var(--_c) transparent;\n          animation: spin 1.2s linear infinite;\n        }'}\n        @keyframes spin {\n          0% {\n            transform: rotate(0deg);\n          }\n          100% {\n            transform: rotate(360deg);\n          }\n        }\n      </style>\n      <div id="vizzucnt">\n        <canvas id="vizzu"></canvas>\n        <div class="spinner"></div>\n      </div>\n      ${this._includeController?'<vizzu-controller id="controller" slider-update="input"></vizzu-controller>':""}\n      `}}try{customElements.get("vizzu-player")?console.warn("VizzuPlayer already defined"):customElements.define("vizzu-player",s)}catch(t){console.error("Failed to register custom element: ",t)}export{e as VizzuController,s as default};
